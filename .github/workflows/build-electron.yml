name: build electron from react web

on:
  push:
    branches:
      - gh-pages

jobs:
  build:
    # Job name is build-electron-from-react-web
    name: build-electron-from-react-web
    # This job runs on Linux
    runs-on: ubuntu-latest
    steps:
      - name: echo the start time
        run: echo The time is `date`
      - name: Checkout Code
        uses: actions/checkout@v2
      - name: Use node
        uses: actions/setup-node@v1
      - name: Show home
        run: echo Home is $HOME and PWD is $GITHUB_WORKSPACE
      - name: Show repo after checkout
        run: ls
      - name: Run yarn to retrieve dependencies
        run: yarn
      - name: Yarn - add capacitor
        run: yarn add @capacitor/core @capacitor/cli
      - name: Initialize capacitor
        run: npx cap init --web-dir "build" "book-package-app" "org.unfoldingword.BookPackageApp"
      - name: Yarn - build
        run: yarn build
      - name: npx cap add electron
        run: npx cap add electron
      - name: show repo after add electron
        run: ls 
      - name: fix electron package.json 
        run: sed -e "s/capacitor-app/book-package-app/" -e "s/An Amazing Capacitor App/Book Package App/" < package.json > x && mv x package.json 
        working-directory: ./electron
      - name: fix electron index.html
        run: sed -e "s#/book-package-app/#./#g" < index.html > x && mv x index.html
        working-directory: ./electron/app
      - name: add electron packager
        run: yarn add electron-packager 
      - name: show packager version
        run: $GITHUB_WORKSPACE/$PKGR --version
        env:
          PKGR: ./node_modules/.bin/electron-packager
      - name: run packager
        run: $GITHUB_WORKSPACE/$PKGR .
        working-directory: ./electron
        env:
          PKGR: ./node_modules/.bin/electron-packager
      - name: show platforms
        run: ls book-package-app-*
        working-directory: ./electron
