{"version":3,"sources":["core/books.ts","core/optimize.tsx","core/csvMaker.ts","core/exportBookPackage.ts","core/export.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["newTestament","list","i","data","length","testament","push","title","oldTestament","titlesToBoolean","ob","bookDataTitles","forEach","v","k","bookIdByTitle","id","bookTitleById","resourcePrefixes","convertUtaToLink","lnk","convertUtwToLink","replace","path","optimize","state","setOpt","a","CircularProgress","allbooks","Object","keys","bookpkg","filter","book","console","log","booksDone","booksOpt","includes","bookCountTotalsPreOpt","Map","bookCountArticleTotalsPreOpt","bklist","bk","bkid","books","res","dbkey","dbsetup","getItem","undefined","rescount","total","grandTotalWordCount","has","set","get","doneGrandTotal","doneArticleMap","dam","detail_article_map","articles","j","articleCount","values","c","resourceTotal","round","optBooks","optCounts","optUtaMap","optUtwMap","refmapUta","refmapUtw","n","newBooks","newCounts","optArticleMap","optBookTotal","roundWinnerBook","roundWinnerCount","summary_ref_map","optUta","optUtw","Typography","map","t","key","toLocaleString","TreeView","defaultCollapseIcon","defaultExpandIcon","TreeItem","nodeId","label","uta","Link","href","target","rel","utw","addRow","csvdata","csvrow","cell","startsWith","endsWith","substring","toCSV","join","exportBookPackage","bookCountTotals","bookCountArticleTotals","csv","row","entries","csvdetails","utqTotal","utnTotal","obsTotal","ultTotal","ustTotal","utaTotal","utwTotal","utaTracker","utwTracker","sufkey","dedupList","Set","csvDownload","exportCounts","ult","ust","utn","utq","download","filename","text","element","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild","useStyles","makeStyles","theme","createStyles","root","width","flexGrow","menuButton","marginRight","spacing","appBar","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","easeOut","enteringScreen","formControl","margin","button","instructions","marginTop","marginBottom","hide","drawer","flexShrink","drawerPaper","drawerHeader","alignItems","padding","mixins","toolbar","justifyContent","content","contentShift","alignItemsAndJustifyContent","offset","GreenCheckbox","withStyles","color","green","checked","props","Checkbox","joinBookIds","x","y","queryProcessedOnce","App","React","useState","setState","activeStep","setActiveStep","skipped","setSkipped","steps","isStepSkipped","step","handleNext","newSkipped","delete","prevActiveStep","query","search","window","location","URLSearchParams","useQuery","bks","barrayIds","split","barrayTitles","alert","name","b","clear","classes","useTheme","anchorEl","setAnchorEl","popen","Boolean","open","setOpen","ts","Date","toISOString","copyToClipboard","str","el","value","position","left","select","execCommand","event","states","ids","origin","pathname","url","defBase","currentTarget","exp","clearFlag","clearF","setClearF","handleChange","handleFinishedChange","_opt","useEffect","opt","message","fetchData","className","CssBaseline","AppBar","clsx","Toolbar","IconButton","aria-label","onClick","edge","variant","Drawer","anchor","paper","direction","Divider","FormGroup","FormControlLabel","control","Switch","onChange","handleChangeClearFlag","Button","disabled","aria-describedby","Popover","onClose","anchorOrigin","vertical","horizontal","transformOrigin","Paper","Stepper","index","stepProps","labelProps","completed","Step","StepLabel","Container","getStepContent","Grid","container","item","xs","FormControl","required","component","FormLabel","FormHelperText","bookId","chapter","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.0861e14c.chunk.js","sourcesContent":["import data from './books.json';\r\nimport * as opt from './optimize'\r\n\r\nexport interface bookDataIF {\r\n  \"id\": string;\r\n  \"title\": string;\r\n  \"usfm\": string;\r\n  \"testament\": string;\r\n  \"verseCount\": number;\r\n  \"chapters\": number[];\r\n}\r\n\r\nexport const chaptersInBook = (bookId: string) => {\r\n    let chapters: number[];\r\n    chapters = bookData(bookId).chapters;\r\n    if ( chapters === undefined ) {\r\n      throw new Error(\"Error: chaptersInBook(): Invalid bookId\");\r\n    }\r\n    return chapters;\r\n};\r\n\r\nexport const versesInChapter = (bookId: string, chapter: number) => {\r\n  const verses = chaptersInBook(bookId)[chapter - 1];\r\n  return verses;\r\n};\r\n\r\nexport const bookData = (bookId: string) => {\r\n  const _bookData: bookDataIF = data.filter(row => row.id === bookId)[0];\r\n  return _bookData;\r\n};\r\n\r\nexport const testament = (bookId: string) => {\r\n  const _testament = bookData(bookId).testament;\r\n  return _testament;\r\n};\r\n\r\nexport const newTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"new\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const oldTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"old\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const bookDataTitles = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n      list.push( data[i].title )\r\n  }\r\n  // add OBS as a pseudobook\r\n  list.push('Open Bible Stories');\r\n  return list;\r\n}\r\n\r\nexport const titlesToBoolean = () => {\r\n  let ob: opt.bpStateIF = {};\r\n  let list = bookDataTitles();\r\n  list.forEach((v,k) => {ob[v]= [false,false]});\r\n  return ob;\r\n}\r\n\r\nexport const bookIdByTitle = (title: string) => {\r\n  if ( title === 'Open Bible Stories' ) return 'obs';\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].title === title ) {\r\n      return data[i].id;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nexport const bookTitleById = (id: string) => {\r\n  if ( id === 'obs' ) return 'Open Bible Stories';\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].title;\r\n    }\r\n  }\r\n  return \"\";\r\n}","import React from 'react';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport TreeView from '@material-ui/lab/TreeView';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport TreeItem from '@material-ui/lab/TreeItem';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport { Link } from '@material-ui/core';\r\n\r\nimport * as dbsetup from 'book-package-rcl';\r\nimport * as books from './books';\r\n\r\nexport interface bpStateIF { [x: string]: boolean[]; };\r\ninterface ObjectLiteral {\r\n    [key: string]: any;\r\n} \r\n\r\n  \r\nconst resourcePrefixes = ['uta-', 'utw-', 'ult-','ust-', 'utq-', 'utn-']\r\n\r\nfunction convertUtaToLink(lnk: string) {\r\n    const path = 'https://git.door43.org/unfoldingWord/en_ta/src/branch/master/translate/';\r\n    return path+lnk;\r\n}\r\n\r\nexport function convertUtwToLink(lnk: string) {\r\n    const path = 'https://git.door43.org/unfoldingWord/en_tw/src/branch/master';\r\n    let s;\r\n    s = lnk;\r\n    s = s.replace(/^rc.*dict(\\/.*$)/, path+'$1.md');\r\n    return s;\r\n}\r\n\r\n\r\nexport async function optimize(state: bpStateIF, setOpt: React.Dispatch<React.SetStateAction<JSX.Element>> ) {\r\n\r\n    setOpt(<CircularProgress/>);\r\n    // extract the books in the package\r\n    const allbooks = Object.keys(state);\r\n    // extract the book package\r\n    const bookpkg    = allbooks.filter( function(book) { return state[book][0] } );\r\n    console.log(\"bookpkg:\",bookpkg);\r\n    // extract the books that are done/completed first (if any)\r\n    const booksDone  = bookpkg.filter( function(book) { return state[book][1] } );\r\n    console.log(\"booksDone:\",booksDone);\r\n    // books to be optimized\r\n    const booksOpt   = bookpkg.filter( function(book) { return !booksDone.includes(book) } );\r\n    console.log(\"booksOpt:\",booksOpt);\r\n\r\n    // count words in each book for pre-optimization summary\r\n    let bookCountTotalsPreOpt = new Map<string,number>();\r\n    let bookCountArticleTotalsPreOpt = new Map<string,number>();\r\n    let bklist: string[] = [];\r\n    for (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n        bklist.push(bkid);\r\n        for (let res of resourcePrefixes) {\r\n            if ( bkid === 'obs' ) {\r\n                if (res === 'uta-' || res === 'ult-' || res === 'ust-' ) {\r\n                    continue; // these resources are not present for OBS\r\n                }\r\n            }\r\n            let dbkey = res+bkid;\r\n            let data = await dbsetup.bpstore.getItem(dbkey);\r\n            let rescount = data.total;\r\n            if ( rescount === undefined ) {\r\n                rescount = data.grandTotalWordCount\r\n                // add to article count (deduped)\r\n                if ( bookCountArticleTotalsPreOpt.has(bkid) ) {\r\n                    bookCountArticleTotalsPreOpt.set(bkid, bookCountArticleTotalsPreOpt.get(bkid) + rescount);\r\n                } else {\r\n                    bookCountArticleTotalsPreOpt.set(bkid,rescount)\r\n                }\r\n            };\r\n            if ( bookCountTotalsPreOpt.has(bkid) ) {\r\n                bookCountTotalsPreOpt.set(bkid, bookCountTotalsPreOpt.get(bkid) + rescount);\r\n            } else {\r\n                bookCountTotalsPreOpt.set(bkid,rescount);\r\n            }\r\n        }    \r\n    }\r\n\r\n    /*\r\n        For the books marked as done, compute their word count contribution by:\r\n        a. create a deduped list of all articles (UTA and UTW) with their counts\r\n        b. compute the grand total of the articles\r\n        c. Add to that the total word counts for UTQ, UTN, ULT, and UST\r\n        d. This sum total will be the starting point for the book package flow.\r\n    */\r\n    let doneGrandTotal = 0;\r\n    let doneArticleMap = new Map<string,number>();\r\n    for (let i=0; i < booksDone.length; i++) {\r\n        // get the UTA articles and their counts\r\n        let bkid = books.bookIdByTitle(booksDone[i]);\r\n        if ( bkid === 'obs' ) continue; // not used in OBS\r\n        let dbkey = \"uta-\"+bkid;\r\n        let data = await dbsetup.bpstore.getItem(dbkey);\r\n        let dam = data.detail_article_map;\r\n        let articles = Object.keys(dam);\r\n        for (let j=0; j< articles.length; j++) {\r\n            let articleCount = dam[articles[j]].total;\r\n            // now add to map. dups expected\r\n            if ( ! doneArticleMap.has(articles[j])) {\r\n                doneArticleMap.set(articles[j], articleCount);\r\n                //console.log(articles[j], articleCount);\r\n            }\r\n        }\r\n\r\n        // get the UTW articles and their counts\r\n        dbkey = \"utw-\"+bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        dam = data.detail_article_map;\r\n        articles = Object.keys(dam);\r\n        for (let j=0; j< articles.length; j++) {\r\n            let articleCount = dam[articles[j]].total;\r\n            // now add to map. dups expected\r\n            if ( ! doneArticleMap.has(articles[j])) {\r\n                doneArticleMap.set(articles[j], articleCount);\r\n                //console.log(articles[j], articleCount);\r\n            }\r\n        }\r\n    }\r\n\r\n    // add up the article contributions\r\n    for ( let c of doneArticleMap.values() ) {\r\n        doneGrandTotal = doneGrandTotal + c;\r\n    }\r\n    console.log(\"done article total is:\", doneGrandTotal);\r\n\r\n    // now add in the UTQ, UTN, ULT, UST for each completed book\r\n    for (let i=0; i < booksDone.length; i++) {\r\n        // get the UTA articles and their counts\r\n        let bkid = books.bookIdByTitle(booksDone[i]);\r\n        let dbkey = \"utq-\"+bkid;\r\n        let data  = await dbsetup.bpstore.getItem(dbkey);\r\n        let resourceTotal = data.total;\r\n        doneGrandTotal = doneGrandTotal + resourceTotal;\r\n        dbkey = \"utn-\"+bkid;\r\n        data  = await dbsetup.bpstore.getItem(dbkey);\r\n        resourceTotal = data.total;\r\n        doneGrandTotal = doneGrandTotal + resourceTotal;\r\n        if ( bkid !== 'obs') {\r\n            dbkey = \"ult-\"+bkid;\r\n            data  = await dbsetup.bpstore.getItem(dbkey);\r\n            resourceTotal = data.total;\r\n            doneGrandTotal = doneGrandTotal + resourceTotal;\r\n            dbkey = \"ust-\"+bkid;\r\n            data  = await dbsetup.bpstore.getItem(dbkey);\r\n            resourceTotal = data.total;\r\n            doneGrandTotal = doneGrandTotal + resourceTotal;\r\n        }\r\n    }\r\n    console.log(\"Done grand total is:\", doneGrandTotal);\r\n    /*\r\n        The above marks the end of the computation of the books \r\n        marked as done.\r\n    */\r\n   \r\n\r\n    /*\r\n        This is the loop that computes the optimized path.\r\n        Given that there are n books to optimize, then the \r\n        loop only needs to be done n-1 times. At that point, \r\n        only one book is left and it will be the last one.\r\n\r\n        The inner loop will loop thru all the remaining \r\n        books to determine which should be next. This is done\r\n        by computing word counts of all the resources\r\n        associated to the book, but excluding any articles \r\n        (i.e., UTA and UTW) that have already been done.\r\n\r\n        The inner loop will be executed one less each time,\r\n        since the winning book in each round will be removed\r\n        from the array of books to be optimized. In the last\r\n        round, there will be two books left to do.\r\n\r\n    */\r\n    interface ObjectLiteral {\r\n        [key: string]: any;\r\n    }    \r\n    let round:number = 0;\r\n    let optBooks: string[] = [];\r\n    let optCounts: number[] = [];\r\n    let optUtaMap = new Map<string,string[]>();\r\n    let optUtwMap = new Map<string,string[]>();\r\n    let refmapUta: ObjectLiteral = { };\r\n    let refmapUtw: ObjectLiteral = { };\r\n\r\n    for (let n=0; n < booksOpt.length; n++ ) {\r\n        round++;\r\n        console.log(\"Begin round:\",round);\r\n        let newBooks: string[] = [];\r\n        let newCounts: number[] = [];\r\n        for (let i=0; i < booksOpt.length; i++) {\r\n            // skip winners from prior rounds\r\n            if ( optBooks.includes(booksOpt[i]) ) {\r\n                continue;\r\n            }\r\n            // The book for this round:\r\n            newBooks.push(booksOpt[i]);\r\n            // get the UTA articles and their counts\r\n            let articles: string[] = [];\r\n            let dbkey = \"\";\r\n            let data: ObjectLiteral = {};\r\n            let dam: ObjectLiteral = {};\r\n            let optArticleMap = new Map<string,number>();\r\n            let bkid = books.bookIdByTitle(booksOpt[i]);\r\n            if ( bkid !== 'obs' ) {\r\n                let dbkey = \"uta-\"+bkid;\r\n                let data = await dbsetup.bpstore.getItem(dbkey);\r\n                let dam = data.detail_article_map;\r\n                articles = Object.keys(dam);\r\n\r\n                // dedup the articles for this book\r\n                // using the article map below\r\n\r\n                for (let j=0; j< articles.length; j++) {\r\n                    // first check to see if this article is in the done list\r\n                    // if so skip it\r\n                    if ( doneArticleMap.has(articles[j]) ) { continue;}\r\n                    let articleCount = dam[articles[j]].total;\r\n                    // now add to map. dups expected\r\n                    optArticleMap.set(articles[j], articleCount);\r\n                    //console.log(articles[j], articleCount);\r\n                }\r\n            }\r\n\r\n            // get the UTW articles and their counts\r\n            dbkey = \"utw-\"+bkid;\r\n            data = await dbsetup.bpstore.getItem(dbkey);\r\n            dam = data.detail_article_map;\r\n            articles = Object.keys(dam);\r\n\r\n            for (let j=0; j< articles.length; j++) {\r\n                // first check to see if this article is in the done list\r\n                // if so skip it\r\n                if ( doneArticleMap.has(articles[j]) ) { continue;}\r\n                let articleCount = dam[articles[j]].total;\r\n                // now add to map\r\n                optArticleMap.set(articles[j], articleCount);\r\n                //console.log(articles[j], articleCount);\r\n            }\r\n\r\n            // add up the article contributions for this book\r\n            let optBookTotal: number = 0;\r\n            for ( let c of optArticleMap.values() ) {\r\n                optBookTotal = optBookTotal + c;\r\n            }\r\n            console.log(\"book article total is:\", booksOpt[i],optBookTotal );\r\n\r\n            // now add in the UTQ, UTN, ULT, UST for each completed book\r\n            dbkey = \"utq-\"+bkid;\r\n            data  = await dbsetup.bpstore.getItem(dbkey);\r\n            optBookTotal = optBookTotal + data.total;\r\n            dbkey = \"utn-\"+bkid;\r\n            data  = await dbsetup.bpstore.getItem(dbkey);\r\n            optBookTotal = optBookTotal + data.total;\r\n            if ( bkid !== 'obs' ) {\r\n                dbkey = \"ult-\"+bkid;\r\n                data  = await dbsetup.bpstore.getItem(dbkey);\r\n                optBookTotal = optBookTotal + data.total;\r\n                dbkey = \"ust-\"+bkid;\r\n                data  = await dbsetup.bpstore.getItem(dbkey);\r\n                optBookTotal = optBookTotal + data.total;\r\n            }\r\n            newCounts.push(optBookTotal);\r\n            console.log(\"Book grand total is:\", booksOpt[i], optBookTotal);\r\n        }\r\n\r\n        /*\r\n            Now we decide which book has the least word count!\r\n        */\r\n        // initialize to the first one\r\n        let roundWinnerBook: string = newBooks[0]; \r\n        let roundWinnerCount: number = newCounts[0]; \r\n        for (let i=1; i < newBooks.length; i++) {\r\n            if (newCounts[i] < roundWinnerCount ) {\r\n                roundWinnerBook = newBooks[i];\r\n                roundWinnerCount = newCounts[i];\r\n            }\r\n        }\r\n        // record the winner\r\n        optBooks.push(roundWinnerBook);\r\n        optCounts.push(roundWinnerCount);\r\n        console.log(\"Round \", round, \"winner is \",roundWinnerBook, \" with count:\", roundWinnerCount);\r\n        \r\n        /* ------------------------------------------------------------\r\n\r\n            Now add the winner's UTA and UTW articles to the done list\r\n            these will not be done again in subsequent rounds\r\n\r\n        */\r\n        let bkid = books.bookIdByTitle(roundWinnerBook);\r\n        if ( bkid !== 'obs' ) {\r\n            let dbkey = \"uta-\"+bkid;\r\n            let data = await dbsetup.bpstore.getItem(dbkey);\r\n            let dam = data.detail_article_map;\r\n            refmapUta = data.summary_ref_map;\r\n            let articles = Object.keys(dam);\r\n            let optUta: string[] = [];\r\n\r\n            for (let j=0; j< articles.length; j++) {\r\n                // first check to see if this article is in the done list\r\n                // if so skip it\r\n                if ( doneArticleMap.has(articles[j]) ) { continue;}\r\n                optUta.push(articles[j] );\r\n                let articleCount = dam[articles[j]].total;\r\n                // now add to map. dups expected\r\n                doneArticleMap.set(articles[j], articleCount);\r\n            }\r\n            optUtaMap.set(roundWinnerBook,optUta);\r\n        }\r\n\r\n        // get the UTW articles and their counts\r\n        let dbkey = \"utw-\"+bkid;\r\n        let data = await dbsetup.bpstore.getItem(dbkey);\r\n        let dam = data.detail_article_map;\r\n        refmapUtw = data.summary_ref_map;\r\n        let articles = Object.keys(dam);\r\n        let optUtw: string[] = [];\r\n\r\n        for (let j=0; j< articles.length; j++) {\r\n            // first check to see if this article is in the done list\r\n            // if so skip it\r\n            if ( doneArticleMap.has(articles[j]) ) { continue;}\r\n            optUtw.push(articles[j] );\r\n            let articleCount = dam[articles[j]].total;\r\n            // now add to map\r\n            doneArticleMap.set(articles[j], articleCount);\r\n        }\r\n        optUtwMap.set(roundWinnerBook,optUtw);\r\n    }\r\n    setOpt (\r\n        <div>\r\n            <br/>\r\n            <br/>\r\n            <div>\r\n                <Typography >\r\n                If these book packages are completed:\r\n                </Typography>\r\n                </div>\r\n                <div>\r\n                <ul>\r\n                {booksDone.map(t => (\r\n                    <li>\r\n                        <Typography key={t}>\r\n                            {t} (Book Package Word Count: {bookCountTotalsPreOpt.get(books.bookIdByTitle(t))?.toLocaleString()} )\r\n                        </Typography>\r\n                    </li>\r\n                ))}\r\n                </ul>\r\n            </div>\r\n            <br/>\r\n            <br/>\r\n            <div>\r\n                <Typography >\r\n                Then proceed in this order:\r\n                </Typography>\r\n                <div>\r\n\r\n                <ol>\r\n                {optBooks.map( (t,i) => (\r\n                    <li>\r\n                        <Typography key={t}>\r\n                        {t} - Adjusted Book Package Word Count: {optCounts[i].toLocaleString()}\r\n                        </Typography>\r\n                        <TreeView\r\n                            defaultCollapseIcon={<ExpandMoreIcon />}\r\n                            defaultExpandIcon={<ChevronRightIcon />}\r\n                        >\r\n                            <TreeItem nodeId=\"1\" label='Unique UTA modules'>\r\n                                <ul>\r\n                                {optUtaMap.get(t)?.map( uta => ( \r\n                                    <li>\r\n                                        <Typography>\r\n                                            <Link href={convertUtaToLink(uta)} target=\"_blank\" rel=\"noopener\" >\r\n                                            {uta}\r\n                                            </Link>\r\n                                            &nbsp;&nbsp;(References: {refmapUta[uta]})\r\n                                        </Typography>                    \r\n                                    </li>\r\n                                ))}\r\n                                </ul>\r\n                            </TreeItem>\r\n                        </TreeView>\r\n\r\n                        <TreeView\r\n                            defaultCollapseIcon={<ExpandMoreIcon />}\r\n                            defaultExpandIcon={<ChevronRightIcon />}\r\n                        >\r\n                            <TreeItem nodeId=\"1\" label='Unique UTW modules'>\r\n                                <ul>\r\n                                {optUtwMap.get(t)?.map( utw => ( \r\n                                    <li>\r\n                                    <Typography>\r\n                                        <Link href={convertUtwToLink(utw)} target=\"_blank\" rel=\"noopener\" >\r\n                                        {utw} \r\n                                        </Link>\r\n                                        &nbsp;&nbsp;(References: {refmapUtw[utw]})\r\n                                    </Typography>                    \r\n                                    </li>\r\n                                ))}\r\n                                </ul>\r\n                                </TreeItem>\r\n                        </TreeView>\r\n\r\n                    </li>\r\n                ) )}\r\n                </ol>\r\n                </div>\r\n            </div>\r\n            <br/>\r\n            <br/>\r\n        </div>\r\n    )\r\n}\r\n\r\n","// CSV Package\r\n\r\n\r\nexport function addRow( csvdata: string[][], csvrow: string[]) {\r\n    // Rules below are a relaxed version of \r\n    // https://tools.ietf.org/html/rfc4180 \r\n    // Specifically, no checks are made to ensure that all rows\r\n    // have the same number of columns.\r\n\r\n    // This function add a new row of strings to an existing 2D array.\r\n\r\n    // Rules:\r\n    // 1. if a cell contains a quote, then the quote must doubled (rfc4180#7)\r\n    // 2. if a cell contains commas, quotes, or line breaks, then the string must quoted (rfc4180#6)\r\n    //    a line break will mean a carriage return (CR) or line feed (LF)\r\n\r\n    for (let i=0; i < csvrow.length; i++) {\r\n        let cell = csvrow[i];\r\n        if ( cell.startsWith('\"') && cell.endsWith('\"') ) {\r\n            // remove the quotes\r\n            cell = cell.substring(1, cell.length-1);\r\n        }\r\n        if ( cell.includes('\"') ) {\r\n            // double the quotes\r\n            cell = cell.replace(/\"/g,'\"\"');\r\n        }\r\n        if ( cell.includes('\"') ) {\r\n            cell = '\"' + cell + '\"';\r\n        } else if ( cell.includes('\\n') ) {\r\n            cell = '\"' + cell + '\"';\r\n        } else if ( cell.includes('\\r') ) {\r\n            cell = '\"' + cell + '\"';\r\n        } else if ( cell.includes(',') ) {\r\n            cell = '\"' + cell + '\"';\r\n        }\r\n        // replace value\r\n        csvrow[i] = cell;\r\n    }\r\n    // push new row onto csv data\r\n    csvdata.push(csvrow);\r\n}\r\n\r\nexport function toCSV( csvdata: string[][] ) : string {\r\n    // Rules below are a relaxed version of \r\n    // https://tools.ietf.org/html/rfc4180 \r\n    // Specifically, no checks are made to ensure that all rows\r\n    // have the same number of columns.\r\n\r\n    // This function combines all the rows into a single string\r\n    // suitable for downloading or importing into a spreadsheet\r\n\r\n    // Rules:\r\n    // 1. join cells in a row with a comma (rfc4180#4); \r\n    //    no comma after last cell\r\n    // 2. join rows with a \\r\\n (CRLF) (rfc4180#1)\r\n    //    use CRLF after last row\r\n\r\n\r\n    let data = \"\";\r\n\r\n    for ( let i=0; i < csvdata.length; i++ ) {\r\n        let row = csvdata[i];\r\n        data = data + row.join(',') + '\\r\\n';\r\n    }\r\n    return data;\r\n}","import * as dbsetup from 'book-package-rcl';\r\nimport * as books from './books';\r\nimport * as csv from './csvMaker';\r\n\r\n\r\nexport interface bpStateIF { [x: string]: boolean[]; };\r\nexport interface csvDataIF { [x: string]: string; };\r\n  \r\nconst resourcePrefixes = ['uta-', 'utw-', 'ult-','ust-', 'utq-', 'utn-', 'obs-']\r\n\r\nexport async function exportBookPackage( state: bpStateIF ): Promise<any> {\r\n    // extract the books in the package\r\n    const allbooks = Object.keys(state);\r\n    // extract the book package\r\n    const bookpkg    = allbooks.filter( function(book) { return state[book][0] } );\r\n    let csvdata: string[][] = [];\r\n\r\n    // count words in each book for summary\r\n    let bookCountTotals = new Map<string,number>();\r\n    let bookCountArticleTotals = new Map<string,number>();\r\n    let bklist: string[] = [];\r\n    for (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n        bklist.push(bkid);\r\n        for (let res of resourcePrefixes) {\r\n            let dbkey = res+bkid;\r\n            let data = await dbsetup.bpstore.getItem(dbkey);\r\n            if ( data === null ) continue; // skip missing data\r\n            let rescount = data.total;\r\n            if ( rescount === undefined ) {\r\n                rescount = data.grandTotalWordCount\r\n                // add to article count (deduped)\r\n                if ( bookCountArticleTotals.has(bkid) ) {\r\n                    bookCountArticleTotals.set(bkid, bookCountArticleTotals.get(bkid) + rescount);\r\n                } else {\r\n                    bookCountArticleTotals.set(bkid,rescount)\r\n                }\r\n            };\r\n            if ( bookCountTotals.has(bkid) ) {\r\n                bookCountTotals.set(bkid, bookCountTotals.get(bkid) + rescount);\r\n            } else {\r\n                bookCountTotals.set(bkid,rescount);\r\n            }\r\n        }    \r\n    }\r\n\r\n    // Add summary to csv data\r\n    let row: string[] = ['Book Package Summary'];\r\n    csv.addRow(csvdata,row);\r\n\r\n    row = ['Book','Word Count'];\r\n    csv.addRow(csvdata,row);\r\n\r\n    let grandTotal = 0;\r\n    for ( let [k,v] of bookCountTotals.entries() ) {\r\n        grandTotal = grandTotal + v;\r\n        let n: string = \"\" + v.toLocaleString();\r\n        row = [books.bookTitleById(k),n];\r\n        csv.addRow(csvdata,row);\r\n    }\r\n\r\n    // Add empty row\r\n    csv.addRow(csvdata,[''])\r\n\r\n    // Add details to csv data\r\n    // use holding table so summary data comes first\r\n    let csvdetails: string[][] = [];\r\n\r\n    row = ['Book Package Details']\r\n    csv.addRow(csvdetails,row);\r\n\r\n    row = ['Resource Type','Book','Word Count']\r\n    csv.addRow(csvdetails,row);\r\n\r\n    // get the UTQ, UTN, ULT, UST for each book\r\n    let utqTotal = 0;\r\n    let utnTotal = 0;\r\n    let obsTotal = 0;\r\n    let ultTotal = 0;\r\n    let ustTotal = 0;\r\n    for (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n\r\n        let dbkey = \"utq-\"+bkid;\r\n        let data  = await dbsetup.bpstore.getItem(dbkey);\r\n        row = ['UTQ',bk,data.total.toLocaleString()];\r\n        csv.addRow(csvdetails,row);\r\n        utqTotal = utqTotal + data.total;\r\n\r\n        dbkey = \"utn-\"+bkid;\r\n        data  = await dbsetup.bpstore.getItem(dbkey);\r\n        row = ['UTN',bk,data.total.toLocaleString()];\r\n        csv.addRow(csvdetails,row);\r\n        utnTotal = utnTotal + data.total;\r\n\r\n        // skip OBS -- they don't have ult/ust\r\n        if ( bkid === 'obs' ) {\r\n            dbkey = \"obs-obs\";\r\n            data  = await dbsetup.bpstore.getItem(dbkey);\r\n            row = ['OBS',bk,data.total.toLocaleString()];\r\n            csv.addRow(csvdetails,row);\r\n            obsTotal = obsTotal + data.total;\r\n            continue; // skip ULT and UST for OBS\r\n        }\r\n\r\n        dbkey = \"ult-\"+bkid;\r\n        data  = await dbsetup.bpstore.getItem(dbkey);\r\n        row = ['ULT',bk,data.total.toLocaleString()];\r\n        csv.addRow(csvdetails,row);\r\n        ultTotal = ultTotal + data.total;\r\n\r\n        dbkey = \"ust-\"+bkid;\r\n        data  = await dbsetup.bpstore.getItem(dbkey);\r\n        row = ['UST',bk,data.total.toLocaleString()];\r\n        csv.addRow(csvdetails,row);\r\n        ustTotal = ustTotal + data.total;\r\n    }\r\n\r\n    // Add empty row\r\n    csv.addRow(csvdetails,[''])\r\n\r\n    row = ['Resource Type','Book','Article','Word Count']\r\n    csv.addRow(csvdetails,row);\r\n\r\n    // get the UTA and UTW for book package\r\n    let utaTotal = 0;\r\n    let utwTotal = 0;\r\n    let utaTracker: string[] = [];\r\n    let utwTracker: string[] = [];\r\n    for (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n\r\n        // get the UTW articles and their counts\r\n        let dbkey = \"utw-\"+bkid;\r\n        let data = await dbsetup.bpstore.getItem(dbkey);\r\n        let dam = data.detail_article_map;\r\n        let articles = Object.keys(dam);\r\n        for (let j=0; j< articles.length; j++) {\r\n            let articleCount = dam[articles[j]].total;\r\n            row = ['UTW',bk,articles[j],\"\"+articleCount.toLocaleString()];\r\n            csv.addRow(csvdetails,row);\r\n            if ( ! utwTracker.includes(articles[j]) ) {\r\n                utwTotal = utwTotal + articleCount;\r\n                utwTracker.push(articles[j]);\r\n            }\r\n        }\r\n\r\n        // skip if OBS\r\n        if ( bkid === 'obs' ) continue;\r\n\r\n        dbkey = \"uta-\"+bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        dam = data.detail_article_map;\r\n        articles = Object.keys(dam);\r\n        for (let j=0; j< articles.length; j++) {\r\n            let articleCount = dam[articles[j]].total;\r\n            row = ['UTA',bk,articles[j],\"\"+articleCount.toLocaleString()];\r\n            csv.addRow(csvdetails,row);\r\n            if ( ! utaTracker.includes(articles[j]) ) {\r\n                utaTotal = utaTotal + articleCount;\r\n                utaTracker.push(articles[j]);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // Add empty row\r\n    csv.addRow(csvdetails,[''])\r\n\r\n    // Get list of errors, if any\r\n    row = ['Book Package Errors']\r\n    csv.addRow(csvdetails,row);\r\n\r\n    const sufkey = '-errors';\r\n    for (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n        for (let res of resourcePrefixes) {\r\n            let dbkey = res+bkid+sufkey;\r\n            let data: string[]  = await dbsetup.bpstore.getItem(dbkey);\r\n            if ( data === null ) { continue }\r\n            let dedupList: string[] = [...new Set(data)]\r\n            for ( let i=0; i < dedupList.length; i++ ) {\r\n                row = [dedupList[i]]\r\n                csv.addRow(csvdetails,row);\r\n            }\r\n        }\r\n    }\r\n\r\n    // now add summary data by resource types\r\n    csv.addRow(csvdata, ['Resource Subtotals'])\r\n    csv.addRow(csvdata, ['ULT',ultTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['UST',ustTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['UTA',utaTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['UTW',utwTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['UTN',utnTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['UTQ',utqTotal.toLocaleString()])\r\n    csv.addRow(csvdata, ['OBS',obsTotal.toLocaleString()])\r\n    // Add empty row\r\n    csv.addRow(csvdata,[''])\r\n\r\n    // now add the details\r\n    for ( let i=0; i < csvdetails.length; i++ ) {\r\n        csv.addRow(csvdata, csvdetails[i]);\r\n    }\r\n\r\n    // Download the CSV data\r\n    // -- first, convert 2d array to CSV string\r\n    let csvDownload = csv.toCSV(csvdata);\r\n    return csvDownload;\r\n\r\n\r\n}\r\n","import * as dbsetup from 'book-package-rcl';\r\nimport * as books from './books';\r\nimport * as csv from './csvMaker';\r\n\r\n/*\r\n    This export is per issue 15. The columns needed are:\r\n    book,ult,ust,utn,utq,utw,uta\r\n\r\n    where book is the id and the values are the (total) count\r\n    per the resource type.\r\n\r\n*/\r\n\r\nexport interface bpStateIF { [x: string]: boolean[]; };\r\nexport interface csvDataIF { [x: string]: string; };\r\n  \r\nexport async function exportCounts( state: bpStateIF ): Promise<any> {\r\n    // extract the books in the package\r\n    const allbooks = Object.keys(state);\r\n    // extract the book package\r\n    const bookpkg = allbooks.filter( function(book) { return state[book][0] } );\r\n    console.log(\"bookpkg:\",bookpkg);\r\n    let csvdata: string[][] = [];\r\n    let row = ['book','ult','ust','utn','utq','utw','uta'];\r\n    csv.addRow(csvdata,row);\r\n\r\n    let ult = \"\";\r\n    let ust = \"\";\r\n    let utn = \"\";\r\n    let utq = \"\";\r\n    let utw = \"\";\r\n    let uta = \"\";\r\nfor (let bk of bookpkg) {\r\n        let bkid = books.bookIdByTitle(bk);\r\n        // define vars for the columns vals\r\n\r\n        // get the count for the book resources\r\n        let dbkey = \"ult-\" + bkid;\r\n        let data = await dbsetup.bpstore.getItem(dbkey);\r\n        let rescount = data.total;\r\n        ult = rescount.toLocaleString();\r\n\r\n        // get the count for the book resources\r\n        dbkey = \"ust-\" + bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        rescount = data.total;\r\n        ust = rescount.toLocaleString();\r\n\r\n        // get the count for the book resources\r\n        dbkey = \"utn-\" + bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        rescount = data.total;\r\n        utn = rescount.toLocaleString();\r\n\r\n        // get the count for the book resources\r\n        dbkey = \"utq-\" + bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        rescount = data.total;\r\n        utq = rescount.toLocaleString();\r\n\r\n        // get the count for the book resources\r\n        dbkey = \"utw-\" + bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        rescount = data.grandTotalWordCount; // note diff!\r\n        utw = rescount.toLocaleString();\r\n\r\n        // get the count for the book resources\r\n        dbkey = \"uta-\" + bkid;\r\n        data = await dbsetup.bpstore.getItem(dbkey);\r\n        rescount = data.grandTotalWordCount; // note diff!\r\n        uta = rescount.toLocaleString();\r\n\r\n        row = [bkid,ult,ust,utn,utq,utw,uta];\r\n        csv.addRow(csvdata,row);\r\n    }\r\n\r\n\r\n    // Download the CSV data\r\n    // -- first, convert 2d array to CSV string\r\n    let csvDownload = csv.toCSV(csvdata);\r\n    return csvDownload;\r\n}\r\n","import React from 'react';\nimport clsx from 'clsx';\nimport { withStyles, makeStyles, useTheme, Theme, createStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Popover from '@material-ui/core/Popover';\n\nimport FormLabel from '@material-ui/core/FormLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport Checkbox, { CheckboxProps } from '@material-ui/core/Checkbox';\n\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport Drawer from '@material-ui/core/Drawer';\nimport Divider from '@material-ui/core/Divider';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\n\nimport Switch from '@material-ui/core/Switch';\n\nimport { green } from '@material-ui/core/colors';\nimport {BookPackageRollup} from 'book-package-rcl';\nimport * as books from '../src/core/books';\nimport * as opt from '../src/core/optimize';\nimport * as csv from '../src/core/exportBookPackage';\nimport * as exp from '../src/core/export';\nimport { Container, CssBaseline, Grid } from '@material-ui/core';\n\nimport * as dbsetup from 'book-package-rcl';\n\nfunction download(filename: string, text: string) {\n    let element = document.createElement('a');\n    element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(text));\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nconst drawerWidth = 240;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n      flexGrow: 1,\n      display: 'flex',\n    },\n    menuButton: {\n      marginRight: theme.spacing(2),\n    },\n    appBar: {\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n    },\n    appBarShift: {\n      width: `calc(100% - ${drawerWidth}px)`,\n      marginLeft: drawerWidth,\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n    },\n    title: {\n      flexGrow: 1,\n    },\n    formControl: {\n      margin: theme.spacing(3),\n    },\n    button: {\n      marginRight: theme.spacing(1),\n    },\n    instructions: {\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n    },\n    hide: {\n      display: 'none',\n    },\n    drawer: {\n      width: drawerWidth,\n      flexShrink: 0,\n    },\n    drawerPaper: {\n      width: drawerWidth,\n    },\n    drawerHeader: {\n      display: 'flex',\n      alignItems: 'center',\n      padding: theme.spacing(0, 1),\n      ...theme.mixins.toolbar,\n      justifyContent: 'flex-end',\n    },\n    content: {\n      flexGrow: 1,\n      padding: theme.spacing(3),\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n      marginLeft: -drawerWidth,\n    },\n    contentShift: {\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n      marginLeft: 0,\n    },\n    alignItemsAndJustifyContent: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n    },  \n    offset: {...theme.mixins.toolbar},\n  }),\n);\n\nconst GreenCheckbox = withStyles({\n  root: {\n    color: green[400],\n    '&$checked': {\n      color: green[600],\n    },\n  },\n  checked: {},\n})((props: CheckboxProps) => <Checkbox color=\"default\" {...props} />);\n\nfunction joinBookIds(state: opt.bpStateIF ) {\n  const x = Object.keys(state);\n  let y: string[] = [];\n  for (let i=0; i<x.length; i++) {\n    if ( state[x[i]][0] ) {\n      y.push(books.bookIdByTitle(x[i]));\n    }\n  }\n  return y.join();\n}\n  \n    \nfunction getSteps() {\n  return ['Select Books', 'Book Package Details', 'Configure Book Package Flow', 'Optimized Flow'];\n}\n\nfunction getStepContent(step: number) {\n  switch (step) {\n    case 0:\n      return 'Select books, then click Next to generate book package details';\n    case 1:\n      return 'Click Next to configure book book package flow optimization';\n    case 2:\n      return 'Select any books completed, then click Next to optimize book package flow';\n    case 3:\n      return 'Optimized Book Package Flow';\n    default:\n      return 'Unknown step';\n  }\n}\n\n// A custom hook that builds on useLocation to parse\n// the query string for you.\nlet queryProcessedOnce = false;\nfunction useQuery() {\n  let search = window.location.search;\n  //console.log(\"url=\",window.location.origin,window.location.pathname)\n  return new URLSearchParams(search);\n}\n\nexport default function App() {\n  const [state, setState] = React.useState({ ...books.titlesToBoolean() }); \n  const [activeStep, setActiveStep] = React.useState(0);\n  const [skipped, setSkipped] = React.useState(new Set<number>());\n  \n  /* ----------------------------------------------------------\n      Stepper\n  */\n  const steps = getSteps();\n\n  const isStepOptional = (step: number) => {\n    return false;\n  };\n\n  const isStepSkipped = (step: number) => {\n    return skipped.has(step);\n  };\n\n\n  const handleBack = () => {\n    setActiveStep(prevActiveStep => prevActiveStep - 1);\n  };\n\n  const handleSkip = () => {\n    if (!isStepOptional(activeStep)) {\n      // You probably want to guard against something like this,\n      // it should never occur unless someone's actively trying to break something.\n      throw new Error(\"You can't skip a step that isn't optional.\");\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(prevSkipped => {\n      const newSkipped = new Set(prevSkipped.values());\n      newSkipped.add(activeStep);\n      return newSkipped;\n    });\n  };\n\n  const handleReset = () => {\n    setActiveStep(0);\n    let states = Object.keys(state);\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n    }\n  };\n\n  const handleNext = () => {\n    let newSkipped = skipped;\n    if (isStepSkipped(activeStep)) {\n      newSkipped = new Set(newSkipped.values());\n      newSkipped.delete(activeStep);\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(newSkipped);\n  };\n\n  let query = useQuery();\n  if ( activeStep === 0 && queryProcessedOnce === false ) {\n    queryProcessedOnce = true;\n    let bks   = query.get(\"books\");\n    if ( bks !== null ) {\n      // user has launched the app with URL query parameters\n      let barrayIds = bks.split(',');\n      let barrayTitles: string[] = [];\n      for ( let i=0; i < barrayIds.length; i++ ) {\n        let x = books.bookTitleById(barrayIds[i]);\n        if ( x === \"\" ) {\n          alert(\"Invalid Book Id:\"+barrayIds[i]);\n          break;\n        }\n        barrayTitles.push(x);\n      }\n      for( let i=0; i < barrayTitles.length; i++) {\n        let name = barrayTitles[i];\n        console.log(\"name:\",name)\n        // set the state variables\n        state[name][0] = true;\n        state[name][1] = false;\n        let b: boolean[] = [];\n        b[0] = true;\n        b[1] = false;  \n      }\n      // skip to step 2...\n      //activeStep = 1; //works sort of\n      handleNext();\n      // for URL, always clear local cache\n      dbsetup.bpstore.clear();\n    }\n  }\n\n\n  const classes = useStyles();\n  const theme = useTheme();\n\n  /* ----------------------------------------------------------\n      Popover\n  */\n  const [anchorEl, setAnchorEl] = React.useState<HTMLButtonElement | null>(null);\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const popen = Boolean(anchorEl);\n  const id = popen ? 'simple-popover' : undefined;\n\n\n  /* ----------------------------------------------------------\n      Menu drawer\n  */\n  const [open, setOpen] = React.useState(false);\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n\n\n  async function handleExportDetails() {\n    let data = await csv.exportBookPackage(state);\n    let ts = new Date().toISOString();\n    let fn = 'BookPackageDetails-' + ts + '.csv';\n    download(fn, data);\n  }\n\n  const copyToClipboard = (str: string) => {\n    const el = document.createElement('textarea');\n    el.value = str;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-9999px';\n    document.body.appendChild(el);\n    el.select();\n    document.execCommand('copy');\n    document.body.removeChild(el);\n  };\n\n  async function handlePermalink(event: React.MouseEvent<HTMLButtonElement>) {\n    const defBase = \"https://unfoldingword.github.io/book-package-app/\";\n    let states = Object.keys(state);\n    let ids: string[] = [];\n    for( let i=0; i < states.length; i++) {\n      let name = states[i];\n      if ( state[name][0] === true ) {\n        // get the id\n        let id = books.bookIdByTitle(name);\n        ids.push(id);\n      }\n    }\n    // build up the URL\n    const origin   = window.location.origin;\n    const pathname = window.location.pathname;\n    const qstring  = '?books=';\n    let url = origin+pathname+qstring+ids.join(',');\n    if ( origin.startsWith(\"file\") ) {\n      url = defBase+qstring+ids.join(',');\n    }\n    copyToClipboard(url);\n    setAnchorEl(event.currentTarget);\n  }\n//http://localhost:3000/book-package-app/?books=gen,exo\n  async function handleDeleteLocalCache() {\n    dbsetup.bpstore.clear();\n  }\n\n  async function handleExportSummary() {\n    let data = await exp.exportCounts(state);\n    let ts = new Date().toISOString();\n    let fn = 'BookPackageSummary-' + ts + '.csv';\n    download(fn, data);\n  }\n\n  const handleSelectNoneOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectNoneNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  /* ----------------------------------------------------------\n      Switch for data refresh\n  */\n const [clearF, setClearF] = React.useState({\n    clearFlag: false,\n  });\n\n  const handleChangeClearFlag = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    setClearF({ ...clearF, [name]: event.target.checked });\n  };\n\n\n  \n  /* ----------------------------------------------------------\n      Form/checkbox stuff \n  */\n  // these are for the initial book seletion\n  const handleChange = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let b: boolean[] = [];\n    b[0] = event.target.checked;\n    b[1] = false;\n    setState({ ...state, [name]: b });\n  };\n\n  const handleFinishedChange = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let b: boolean[] = [];\n    b[0] = true;\n    b[1] = event.target.checked;\n    setState({ ...state, [name]: b });\n  };\n\n  const [_opt, setOpt] = React.useState(<CircularProgress/>);\n  React.useEffect( () => {\n    const fetchData = async () => {\n      try {\n        await opt.optimize(state, setOpt);\n      } catch (error) {\n        setOpt(\n          <div>\n            {error.message}\n          </div>\n        )\n        return;\n      }\n    };\n    if (activeStep !== 3) {return;}\n    fetchData();\n  }, [state,activeStep]); \n  // the parameter [] allows the effect to skip if value unchanged\n  // an empty [] will only update on mount of component\n  \n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position=\"fixed\" \n          className={clsx(classes.appBar, {[classes.appBarShift]: open })}>\n        <Toolbar>\n          <IconButton\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n            onClick={handleDrawerOpen}\n            edge=\"start\"\n            className={clsx(classes.menuButton, open && classes.hide)}\n          >\n            <MenuIcon />\n          </IconButton>\n          <Typography variant=\"h6\" className={classes.title}>\n            Book Package and Flow Optimization\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <Drawer\n        className={classes.drawer}\n        variant=\"persistent\"\n        anchor=\"left\"\n        open={open}\n        classes={{\n          paper: classes.drawerPaper,\n        }}\n      >\n        <div className={classes.drawerHeader}>\n          <IconButton onClick={handleDrawerClose}>\n            {theme.direction === 'ltr' ? <ChevronLeftIcon /> : <ChevronRightIcon />}\n          </IconButton>\n        </div>\n        <Divider />\n        <FormGroup row>\n            <FormControlLabel\n              control={\n                <Switch checked={clearF.clearFlag} onChange={handleChangeClearFlag('clearFlag')} value=\"clearFlag\" color=\"primary\" />\n              }\n              label=\"Refresh Book Package Data\"\n            />\n        </FormGroup>\n        <Divider />\n              <Button disabled={activeStep !== 0 } onClick={handleDeleteLocalCache} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Delete Local Cache\n              </Button>\n              <Divider />\n              <Button disabled={activeStep !==1 }   onClick={handleExportDetails} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Export Snapshot\n              </Button>\n              <Divider />\n              <Button disabled={activeStep === 0 } aria-describedby={id}  \n                onClick={handlePermalink} color=\"primary\" variant=\"contained\" className={classes.button}\n              >\n              Copy Link\n              </Button>\n              <Popover\n                id={id}\n                open={popen}\n                anchorEl={anchorEl}\n                onClose={handleClose}\n                anchorOrigin={{\n                  vertical: 'bottom',\n                  horizontal: 'center',\n                }}\n                transformOrigin={{\n                  vertical: 'top',\n                  horizontal: 'center',\n                }}\n              >\n                <Typography>Link copied to clipboard!</Typography>\n              </Popover>\n      </Drawer> \n      <Paper>\n        <Typography> <br/> <br/> </Typography>\n        <Stepper activeStep={activeStep}>\n          {steps.map((label, index) => {\n            const stepProps: { completed?: boolean } = {};\n            const labelProps: { optional?: React.ReactNode } = {};\n            if (isStepOptional(index)) {\n              labelProps.optional = <Typography variant=\"caption\">Optional</Typography>;\n            }\n            if (isStepSkipped(index)) {\n              stepProps.completed = false;\n            }\n            return (\n              <Step key={label} {...stepProps}>\n                <StepLabel {...labelProps}>{label}</StepLabel>\n              </Step>\n            );\n          })}\n        </Stepper>\n        <Container>\n          <div className={classes.alignItemsAndJustifyContent}>\n          <Typography className={classes.instructions}>{getStepContent(activeStep)}</Typography>\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n            <Button disabled={activeStep === 0} onClick={handleBack} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Back\n            </Button>\n\n            {isStepOptional(activeStep) && (\n              <Button variant=\"contained\" color=\"primary\" onClick={handleSkip} className={classes.button}>\n                Skip\n              </Button>\n            )}\n\n            <Button disabled={activeStep === 3} variant=\"contained\" color=\"primary\" onClick={handleNext} className={classes.button}>\n              Next\n            </Button>\n\n            {activeStep === 1 && (\n              <Button onClick={handleExportSummary} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Export\n              </Button>\n            )}\n\n            {activeStep === 3 && (\n              <Button onClick={handleReset} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Start Over\n              </Button>\n            )}\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n            {(activeStep === 0) && (\n              <Grid container spacing={3}>\n                <Grid item xs={5}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">Old Testament</FormLabel>\n                    <FormGroup>\n                      {books.oldTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n                <Grid item xs={2}>\n                <Typography> <br/> <br/> <br/> </Typography>\n                  <Paper>\n                  <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormGroup>\n                        <FormControlLabel\n                          control={\n                            <Checkbox checked={state['Open Bible Stories'][0]} \n                              onChange={handleChange('Open Bible Stories')} \n                              value='Open Bible Stories' />\n                          }\n                          label='Open Bible Stories' key='Open Bible Stories'\n                        />\n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n                <Grid item xs={5}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">New Testament</FormLabel>\n                    <FormGroup>\n                      {books.newTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n              </Grid>\n            )}\n\n\n            {(activeStep === 1) && (\n              <div>\n                <Paper>\n                  <BookPackageRollup bookId={joinBookIds(state)} chapter='' clearFlag={clearF.clearFlag} />\n                </Paper>\n              </div>\n            )}\n\n\n            {(activeStep === 2 ) && (\n              <Paper>\n                <FormControl required component=\"fieldset\" className={classes.formControl}>\n                <FormLabel component=\"legend\">Select one or more</FormLabel>\n                <FormGroup>\n                  <div>\n                    {Object.keys(state)\n                      .filter(function(book) {\n                        return state[book][0];\n                      }).map(t => (\n                        <FormControlLabel\n                        control={<GreenCheckbox checked={state[t][1]} onChange={handleFinishedChange(t)} value={t} key={t} />}\n                        label={t}\n                      />\n                    ))}\n                  </div>                \n                </FormGroup>\n                <FormHelperText />\n                </FormControl>\n              </Paper>\n            )}\n\n            {(activeStep === 3) && (\n              <Paper>\n                {_opt}\n              </Paper>\n            )}\n          </div>\n        </Container>\n      </Paper>\n    </div>\n  );\n}\n\n/*\nhttp://localhost:3000/book-package-app/?books=mat,mrk,luk,jhn,act,rom,1co,2co,gal,eph,php,col,1th,2th,1ti,2ti,tit,phm,heb,jas,1pe,2pe,1jn,2jn,3jn,jud,rev\n\n\n\n\n*/\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}